pipeline {
    agent any

    stages {

        
        stage('Download CCCCCookbooksss') {
            steps {
                
                git 'https://github.com/shubhu014/Jenkins-Chef-Demo.git'
                
            }
        }
        stage('Move recipe to required location') {
            steps {
                //sh 'chef generate cookbook Jenkins-Chef-trial'
                //sh 'sudo mkdir -p /home/ubuntu/chef-repo/cookbooks/Jenkins-Chef-trial'
                //sh 'sudo mv /var/lib/jenkins/workspace/Jenkins-Chef/Jenkins-Chef-trial /home/ubuntu/chef-repo/cookbooks/'
                sh 'sudo mv /var/lib/jenkins/workspace/Jenkins-Chef/recipes/default.rb /home/ubuntu/chef-repo/cookbooks/Jenkins-Chef-trial/recipes/'
           }
       }
        stage('Updating chef workstation') {
            steps {
                  sh "cd /home/ubuntu/chef-repo/cookbooks/" && sh "chef-client -zr 'recipe[Jenkins-Chef-trial]'"
                }
       }
       
          stage('Upload cookbook to chef server') {
            steps {
                //sh 'cd /home/ubuntu/chef-repo'
                sh "sudo knife cookbook upload Jenkins-Chef-trial --force -o /home/ubuntu/chef-repo/cookbooks -c /home/ubuntu/chef-repo/.chef/config.rb"
           }
       }
       
        
        
        
        
    }
}
